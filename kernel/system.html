<script>
var msgIndex = 0
var appIndex = undefined
const secureApps = ["*ROOT"]
const system = (message) => {
    // if (typeof message == "string") {
    //     message = { message }
    // }
    msgIndex++
    var e = new CustomEvent('system', { detail: message })
    window.parent.document.dispatchEvent(e)
}
window.addEventListener("system", (event) => {
    const detail = event.detail
    if(secureApps.includes(detail.from)) {
        console.info(detail)
        if(appIndex == undefined && detail.appIndex) {
            appIndex = detail.appIndex
            secureApps.push(appIndex)
            return
        }
        if(window.handleMessage) 
            handleMessage(detail.data)
        // the first message will contain important data
        // app index, parent elements, etc.
    }
})
    
</script>